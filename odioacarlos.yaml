Release "operator" does not exist. Installing it now.
NAME: operator
LAST DEPLOYED: Wed Feb 11 16:02:57 2026
NAMESPACE: apigee
STATUS: pending-install
REVISION: 1
DESCRIPTION: Dry run complete
TEST SUITE: None
HOOKS:
---
# Source: apigee-operator/templates/apigee-operators-guardrails.yaml
apiVersion: v1
kind: Pod
metadata:
  name: apigee-hybrid-helm-guardrail-operator
  namespace: apigee
  annotations:
    helm.sh/hook: pre-install,pre-upgrade
    helm.sh/hook-delete-policy: before-hook-creation,hook-succeeded
  labels:
    app: apigee-hybrid-helm-guardrail
spec:
  affinity:
    nodeAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        preference:
          matchExpressions:
          - key: "karpenter.sh/nodepool"
            operator: In
            values:
            - "adp-default"
  securityContext:
    runAsNonRoot: true
    runAsUser: 999
    runAsGroup: 998
  containers:
    - name: apigee-hybrid-helm-guardrail-container
      image: gcr.io/apigee-release/hybrid/apigee-watcher:1.16.0
      imagePullPolicy: IfNotPresent
      command: ['/helmguardrails']
      env:
      - name: COMPONENT
        value: "operator"
      - name: PROJECTID
        value: pocapigee-485810
      - name: CHECKPOINT
        value: "pre-install"
      - name: APIGEE_ENDPOINT
        value: https://apigee.googleapis.com
      - name: http_proxy
        value: http://proxy-gamp-hybrid-d2vpp.internet-dev.ec1.aws.aztec.cloud.allianz:8080
      - name: GOOGLE_APPLICATION_CREDENTIALS
        value: /etc/secret/client_secret.json
      securityContext:
        allowPrivilegeEscalation: false
        readOnlyRootFilesystem: true
        capabilities:
          drop:
          - ALL
      resources:
        requests:
          cpu: 500m
          memory: 64Mi
      volumeMounts:
      - readOnly: true
        name: "svc-account-volume"
        mountPath: /etc/secret
  volumes:
  - name: "svc-account-volume"
    secret:
      secretName: apigee-non-prod-svc-account
  restartPolicy: Never
  terminationGracePeriodSeconds: 0
MANIFEST:
---
# Source: apigee-operator/templates/apigee-operators.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: apigee-manager
  namespace: apigee
---
# Source: apigee-operator/templates/apigee-operators.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: apigee-metrics-adapter
  namespace: apigee
---
# Source: apigee-operator/templates/apigee-operators-roles.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  labels:
    apigee.cloud.google.com/platform: apigee
  name: apigee-metrics-adapter-apigee-telemetry-apigee
rules:
  - apiGroups:
      - ""
    resources:
      - namespaces
      - configmaps
    verbs:
      - get
      - list
      - watch
  - apiGroups:
      - authorization.k8s.io
    resources:
      - subjectaccessreviews
    verbs:
      - create
      - get
      - list
---
# Source: apigee-operator/templates/apigee-operators.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: apigee-manager-role-apigee
rules:
- apiGroups:
  - ""
  resources:
  - namespaces
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - nodes
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - persistentvolumes
  verbs:
  - get
  - list
- apiGroups:
  - ""
  resources:
  - persistentvolumes
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - apiextensions.k8s.io
  resources:
  - customresourcedefinitions
  verbs:
  - get
- apiGroups:
  - apiregistration.k8s.io
  resources:
  - apiservices
  - apiservices/finalizers
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - authorization.k8s.io
  resources:
  - subjectaccessreviews
  verbs:
  - create
  - get
  - list
- apiGroups:
  - apigee.cloud.google.com
  resources:
  - apigeetelemetries/finalizers
  verbs:
  - get
  - patch
  - update
---
# Source: apigee-operator/templates/apigee-operators.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  labels:
    apigee.cloud.google.com/platform: apigee
  name: apigee-proxy-role-apigee
rules:
- apiGroups:
  - authentication.k8s.io
  resources:
  - tokenreviews
  verbs:
  - create
- apiGroups:
  - authorization.k8s.io
  resources:
  - subjectaccessreviews
  verbs:
  - create
---
# Source: apigee-operator/templates/istiod-cluster-role.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: apigee-ingressgateway-manager-apigee
  labels:
    apigee.cloud.google.com/platform: apigee
rules:
- apiGroups:
  - ""
  resources:
  - nodes
  - namespaces
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - networking.k8s.io
  resources:
  - ingressclasses
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - gateway.networking.k8s.io
  resources:
  - gatewayclasses
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - authorization.k8s.io
  resources:
  - subjectaccessreviews
  verbs:
  - create
- apiGroups:
  - apiextensions.k8s.io
  resources:
  - customresourcedefinitions
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - admissionregistration.k8s.io
  resources:
  - mutatingwebhookconfigurations
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - authentication.k8s.io
  resources:
  - tokenreviews
  verbs:
  - create
- apiGroups:
  - networking.istio.io
  resources:
  - sidecars
  - destinationrules
  - gateways
  - virtualservices
  - envoyfilters
  - workloadentries
  - serviceentries
  - workloadgroups
  - proxyconfigs
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - security.istio.io
  resources:
  - peerauthentications
  - authorizationpolicies
  - requestauthentications
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - telemetry.istio.io
  resources:
  - telemetries
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - extensions.istio.io
  resources:
  - wasmplugins
  verbs:
  - get
  - list
  - watch
---
# Source: apigee-operator/templates/apigee-operators-roles.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  labels:
    apigee.cloud.google.com/platform: apigee
  name: apigee-metrics-adapter-apigee-telemetry-apigee
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: apigee-metrics-adapter-apigee-telemetry-apigee
subjects:
  - kind: ServiceAccount
    name: apigee-metrics-adapter
    namespace: apigee
  - kind: ServiceAccount
    name: apigee-metrics-adapter-apigee-telemetry
    namespace: apigee
---
# Source: apigee-operator/templates/apigee-operators.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  labels:
    apigee.cloud.google.com/platform: apigee
  name: apigee-manager-rolebinding-apigee
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: apigee-manager-role-apigee
subjects:
- kind: ServiceAccount
  name: apigee-manager
  namespace: apigee
---
# Source: apigee-operator/templates/apigee-operators.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  labels:
    apigee.cloud.google.com/platform: apigee
  name: apigee-proxy-rolebinding-apigee
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: apigee-proxy-role-apigee
subjects:
- kind: ServiceAccount
  name: apigee-manager
  namespace: apigee
---
# Source: apigee-operator/templates/istiod-cluster-role-binding.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: apigee-ingressgateway-manager-apigee
  labels:
    apigee.cloud.google.com/platform: apigee
subjects:
- kind: ServiceAccount
  name: apigee-ingressgateway-manager
  namespace: apigee
roleRef:
  kind: ClusterRole
  name: apigee-ingressgateway-manager-apigee
  apiGroup: rbac.authorization.k8s.io
---
# Source: apigee-operator/templates/apigee-operators-roles.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  labels:
    apigee.cloud.google.com/platform: apigee
  name: apigee-metrics-apigee-telemetry
  namespace: apigee
rules:
  - apiGroups:
      - ""
    resources:
      - pods
    verbs:
      - get
      - list
      - watch
---
# Source: apigee-operator/templates/apigee-operators-roles.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  labels:
    apigee.cloud.google.com/platform: apigee
  name: apigee-metrics-adapter-apigee-telemetry
  namespace: apigee
rules:
  - apiGroups:
      - ""
    resources:
      - pods
      - services
    verbs:
      - get
      - list
      - watch
---
# Source: apigee-operator/templates/apigee-operators.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: apigee-leader-election-role
  namespace: apigee
rules:
- apiGroups:
  - ""
  resources:
  - configmaps
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
  - delete
- apiGroups:
  - ""
  resources:
  - configmaps/status
  verbs:
  - get
  - update
  - patch
- apiGroups:
  - ""
  resources:
  - events
  verbs:
  - create
---
# Source: apigee-operator/templates/apigee-operators.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: apigee-manager-role
  namespace: apigee
rules:
- apiGroups:
  - rbac.authorization.k8s.io
  resources:
  - roles
  - rolebindings
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - ""
  resources:
  - configmaps
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - configmaps
  - pods
  - secrets
  - serviceaccounts
  - services
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - ""
  resources:
  - configmaps
  - secrets
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - ""
  resources:
  - events
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - ""
  resources:
  - events
  - persistentvolumeclaims
  - services
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - ""
  resources:
  - pods
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - nodes
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - persistentvolumeclaims
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - ""
  resources:
  - persistentvolumeclaims
  - pods
  verbs:
  - get
  - list
- apiGroups:
  - ""
  resources:
  - pods
  verbs:
  - delete
  - get
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - resourcequotas
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - ""
  resources:
  - secrets
  - services
  verbs:
  - batch
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - ""
  resources:
  - serviceaccounts
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - apigee.cloud.google.com
  resources:
  - apigeedatastores
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - apigee.cloud.google.com
  resources:
  - apigeedatastores/finalizers
  verbs:
  - get
  - patch
  - update
- apiGroups:
  - apigee.cloud.google.com
  resources:
  - apigeedatastores/status
  verbs:
  - get
  - patch
  - update
- apiGroups:
  - apigee.cloud.google.com
  resources:
  - apigeedeployments
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - apigee.cloud.google.com
  resources:
  - apigeedeployments/finalizers
  verbs:
  - get
  - patch
  - update
- apiGroups:
  - apigee.cloud.google.com
  resources:
  - apigeedeployments/status
  verbs:
  - get
  - patch
  - update
- apiGroups:
  - apigee.cloud.google.com
  resources:
  - apigeeenvironments
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - apigee.cloud.google.com
  resources:
  - apigeeenvironments/finalizers
  verbs:
  - get
  - patch
  - update
- apiGroups:
  - apigee.cloud.google.com
  resources:
  - apigeeenvironments/status
  verbs:
  - get
  - patch
  - update
- apiGroups:
  - apigee.cloud.google.com
  resources:
  - apigeeissues
  verbs:
  - create
  - delete
  - get
  - list
  - watch
- apiGroups:
  - apigee.cloud.google.com
  resources:
  - apigeeorganizations
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - apigee.cloud.google.com
  resources:
  - apigeeorganizations/finalizers
  verbs:
  - get
  - patch
  - update
- apiGroups:
  - apigee.cloud.google.com
  resources:
  - apigeeorganizations/status
  verbs:
  - get
  - patch
  - update
- apiGroups:
  - apigee.cloud.google.com
  resources:
  - apigeeredis
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - apigee.cloud.google.com
  resources:
  - apigeeredis/finalizers
  verbs:
  - get
  - patch
  - update
- apiGroups:
  - apigee.cloud.google.com
  resources:
  - apigeeredis/status
  verbs:
  - get
  - patch
  - update
- apiGroups:
  - apigee.cloud.google.com
  resources:
  - apigeerouteconfigs
  verbs:
  - get
  - list
- apiGroups:
  - apigee.cloud.google.com
  resources:
  - apigeeroutes
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - apigee.cloud.google.com
  resources:
  - apigeeroutes/finalizers
  verbs:
  - get
  - patch
  - update
- apiGroups:
  - apigee.cloud.google.com
  resources:
  - apigeeroutes/status
  verbs:
  - get
  - patch
  - update
- apiGroups:
  - apigee.cloud.google.com
  resources:
  - apigeetelemetries
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - apigee.cloud.google.com
  resources:
  - apigeetelemetries/finalizers
  verbs:
  - get
  - patch
  - update
- apiGroups:
  - apigee.cloud.google.com
  resources:
  - apigeetelemetries/status
  verbs:
  - get
  - list
  - patch
  - update
- apiGroups:
  - apigee.cloud.google.com
  resources:
  - cassandradatareplications
  verbs:
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - apigee.cloud.google.com
  resources:
  - cassandradatareplications/finalizers
  verbs:
  - get
  - patch
  - update
- apiGroups:
  - apigee.cloud.google.com
  resources:
  - cassandradatareplications/status
  verbs:
  - get
  - patch
  - update
- apiGroups:
  - apigee.cloud.google.com
  resources:
  - secretrotations
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - apigee.cloud.google.com
  resources:
  - secretrotations/finalizers
  verbs:
  - update
- apiGroups:
  - apigee.cloud.google.com
  resources:
  - secretrotations/status
  verbs:
  - get
  - patch
  - update
- apiGroups:
  - apps
  resources:
  - daemonsets
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - apps
  resources:
  - daemonsets
  - replicasets
  - statefulsets
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - apps
  resources:
  - deployments
  verbs:
  - get
  - list
  - patch
  - update
- apiGroups:
  - apps
  resources:
  - statefulsets
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - autoscaling
  resources:
  - horizontalpodautoscalers
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - batch
  resources:
  - cronjobs
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - batch
  resources:
  - jobs
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - cert-manager.io
  resources:
  - certificates
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - cert-manager.io
  resources:
  - certificates
  - certificates/finalizers
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - cert-manager.io
  resources:
  - issuers
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - coordination.k8s.io
  resources:
  - leases
  verbs:
  - create
  - get
  - list
  - update
- apiGroups:
  - networking.istio.io
  resources:
  - destinationrules
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - networking.istio.io
  resources:
  - gateways
  - virtualservices
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - policy
  resources:
  - poddisruptionbudgets
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - security.istio.io
  resources:
  - peerauthentications
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
---
# Source: apigee-operator/templates/cassandra-backup-role.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: apigee-cassandra-backup
  namespace: apigee
rules:
- apiGroups:
    - ""
  resources:
    - persistentvolumeclaims
  verbs:
    - list
- apiGroups:
    - ""
  resources:
    - pods
  verbs:
    - get
    - list
- apiGroups:
    - snapshot.storage.k8s.io
  resources:
    - volumesnapshots
  verbs:
    - get
    - create
- apiGroups:
    - apigee.cloud.google.com
  resources:
    - apigeedatastores
  verbs:
    - get
    - list
---
# Source: apigee-operator/templates/cassandra-restore-role.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: apigee-cassandra-restore
  namespace: apigee
rules:
- apiGroups:
    - ""
  resources:
    - pods
  verbs:
    - get
    - list
    - deletecollection
- apiGroups:
    - ""
  resources:
    - persistentvolumeclaims
  verbs:
    - get
    - list
    - create
- apiGroups:
    - snapshot.storage.k8s.io
  resources:
    - volumesnapshots
  verbs:
    - get
    - list
- apiGroups:
    - apigee.cloud.google.com
  resources:
    - apigeedatastores
  verbs:
    - get
    - list
    - delete
    - create
---
# Source: apigee-operator/templates/ingress-role.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: apigee-ingressgateway-sds-apigee
  namespace: apigee
  labels:
    apigee.cloud.google.com/platform: apigee
rules:
- apiGroups:
  - ""
  resources:
  - secrets
  verbs:
  - get
  - watch
  - list
---
# Source: apigee-operator/templates/istiod-role.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: apigee-ingressgateway-manager-apigee
  namespace: apigee
  labels:
    apigee.cloud.google.com/platform: apigee
rules:
- apiGroups:
  - extensions
  - apps
  resources:
  - deployments
  - replicasets
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - pods
  - services
  - endpoints
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - discovery.k8s.io
  resources:
  - endpointslices
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - networking.k8s.io
  resources:
  - ingresses
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - networking.k8s.io
  resources:
  - ingresses/status
  verbs:
  - '*'
- apiGroups:
  - ""
  resources:
  - configmaps
  verbs:
  - create
  - get
  - list
  - watch
  - update
- apiGroups:
  - certificates.k8s.io
  resources:
  - certificatesigningrequests
  - certificatesigningrequests/approval
  - certificatesigningrequests/status
  verbs:
  - update
  - create
  - get
  - delete
  - watch
- apiGroups:
  - certificates.k8s.io
  resourceNames:
  - kubernetes.io/legacy-unknown
  resources:
  - signers
  verbs:
  - approve
- apiGroups:
  - ""
  resources:
  - secrets
  verbs:
  - create
  - get
  - watch
  - list
  - update
  - delete
- apiGroups:
  - ""
  resources:
  - serviceaccounts
  verbs:
  - get
  - watch
  - list
- apiGroups:
  - networking.x.k8s.io
  resources:
  - '*'
  verbs:
  - get
  - watch
  - list
- apiGroups:
  - ""
  resources:
  - events
  verbs:
  - create
  - patch
- apiGroups:
  - apigee.cloud.google.com
  resources:
  - apigeeroutes
  - apigeedeployments
  - apigeeorganizations
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - coordination.k8s.io
  resources:
  - leases
  verbs:
  - get
  - create
  - update
- apiGroups:
  - gateway.networking.k8s.io
  resources:
  - gateways
  - referencegrants
  - grpcroutes
  - httproutes
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - networking.istio.io
  resources:
  - serviceentries
  verbs:
  - get
  - list
  - watch
---
# Source: apigee-operator/templates/apigee-operators-roles.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  labels:
    apigee.cloud.google.com/platform: apigee
  name: apigee-metrics-apigee-telemetry
  namespace: apigee
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: apigee-metrics-apigee-telemetry
subjects:
  - kind: ServiceAccount
    name: apigee-metrics-apigee-telemetry
    namespace: apigee
---
# Source: apigee-operator/templates/apigee-operators-roles.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  labels:
    apigee.cloud.google.com/platform: apigee
  name: apigee-metrics-adapter-apigee-telemetry
  namespace: apigee
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: apigee-metrics-adapter-apigee-telemetry
subjects:
  - kind: ServiceAccount
    name: apigee-metrics-adapter
    namespace: apigee
  - kind: ServiceAccount
    name: apigee-metrics-adapter-apigee-telemetry
    namespace: apigee
---
# Source: apigee-operator/templates/apigee-operators.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: apigee-leader-election-rolebinding
  namespace: apigee
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: apigee-leader-election-role
subjects:
- kind: ServiceAccount
  name: apigee-manager
  namespace: apigee
---
# Source: apigee-operator/templates/apigee-operators.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  labels:
    apigee.cloud.google.com/platform: apigee
  name: apigee-manager-rolebinding
  namespace: apigee
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: apigee-manager-role
subjects:
- kind: ServiceAccount
  name: apigee-manager
  namespace: apigee
---
# Source: apigee-operator/templates/cassandra-backup-role-binding.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: apigee-cassandra-backup
  namespace: apigee
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: apigee-cassandra-backup
subjects:
- kind: ServiceAccount
  name: apigee-cassandra-backup-sa
  namespace: apigee
---
# Source: apigee-operator/templates/cassandra-restore-role-binding.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: apigee-cassandra-restore
  namespace: apigee
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: apigee-cassandra-restore
subjects:
- kind: ServiceAccount
  name: apigee-cassandra-restore-sa
  namespace: apigee
---
# Source: apigee-operator/templates/ingress-role-binding.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: apigee-ingressgateway-sds-apigee
  namespace: apigee
  labels:
    apigee.cloud.google.com/platform: apigee
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: apigee-ingressgateway-sds-apigee
subjects:
- kind: ServiceAccount
  name: apigee-ingressgateway
  namespace: apigee
---
# Source: apigee-operator/templates/istiod-role-binding.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: apigee-ingressgateway-manager-apigee
  namespace: apigee
  labels:
    apigee.cloud.google.com/platform: apigee
subjects:
- kind: ServiceAccount
  name: apigee-ingressgateway-manager
  namespace: apigee
roleRef:
  kind: Role
  name: apigee-ingressgateway-manager-apigee
  apiGroup: rbac.authorization.k8s.io
---
# Source: apigee-operator/templates/apigee-operators.yaml
apiVersion: v1
kind: Service
metadata:
  labels:
    apigee.cloud.google.com/platform: apigee
    control-plane: controller-manager
  name: apigee-controller-manager-metrics-service
  namespace: apigee
spec:
  ports:
  - name: https
    port: 8443
    protocol: TCP
    targetPort: https
  selector:
    control-plane: controller-manager
---
# Source: apigee-operator/templates/apigee-operators.yaml
apiVersion: v1
kind: Service
metadata:
  labels:
    apigee.cloud.google.com/platform: apigee
  name: apigee-webhook-service
  namespace: apigee
spec:
  ports:
  - port: 443
    protocol: TCP
    targetPort: 9443
  selector:
    control-plane: controller-manager
---
# Source: apigee-operator/templates/apigee-operators-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    apigee.cloud.google.com/platform: apigee
    control-plane: controller-manager
  name: apigee-controller-manager
  namespace: apigee
spec:
  replicas: 1
  selector:
    matchLabels:
      control-plane: controller-manager
  template:
    metadata:
      labels:
        apigee.cloud.google.com/platform: apigee
        app: apigee-controller
        app.kubernetes.io/component: manager
        app.kubernetes.io/created-by: k8s-controllers
        app.kubernetes.io/instance: controller-manager
        app.kubernetes.io/managed-by: kustomize
        app.kubernetes.io/name: deployment
        app.kubernetes.io/part-of: k8s-controllers
        control-plane: controller-manager
        revision: ""
    spec:
      securityContext:
        runAsNonRoot: true
        runAsGroup: 998
        runAsUser: 999
        seccompProfile:
          type: RuntimeDefault
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - weight: 100
            preference:
              matchExpressions:
              - key: "karpenter.sh/nodepool"
                operator: In
                values:
                - "adp-default"
      containers:
      - args:
        - --tls-cert-file=/tmp/k8s-webhook-server/serving-certs/tls.crt
        - --tls-private-key-file=/tmp/k8s-webhook-server/serving-certs/tls.key
        - --secure-listen-address=0.0.0.0:8443
        - --upstream=http://127.0.0.1:8080/
        - --logtostderr=true
        - --v=10
        image: gcr.io/apigee-release/hybrid/apigee-kube-rbac-proxy:1.16.0
        imagePullPolicy: IfNotPresent
        name: kube-rbac-proxy
        ports:
        - containerPort: 8443
          name: https
          protocol: TCP
        resources:
          limits:
            cpu: 500m
            memory: 128Mi
          requests:
            cpu: 5m
            memory: 64Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: true
          runAsGroup: 998
          runAsNonRoot: true
          runAsUser: 999
        volumeMounts:
        - mountPath: /tmp/k8s-webhook-server/serving-certs
          name: cert
          readOnly: true
      - args:
        - --health-probe-bind-address=:8081
        - --metrics-bind-address=127.0.0.1:8080
        - --leader-elect
        - --apigee-runtime-type=hybrid
        - --log-level=info
        - --enable-webhooks=true
        - --enable-controllers=true
        - --disable-embedded-asm-apigee-route-controller=true
        - --disable-embedded-asm-apigee-deployment-controller=true
        - --enable-api-client=true
        - --disable-istio-config-in-apiserver=true
        - --disable-fluentd-size-limit=false
        - --disable-managed-clusterroles=true
        - --disable-sa-volume-projection=true
        - --disable-secret-rotation-controller=false
        - --enable-seccomp-profile=true
        command:
        - /manager
        env:
        - name: POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        image: gcr.io/apigee-release/hybrid/apigee-operators:1.16.0
        imagePullPolicy: Always
        livenessProbe:
          failureThreshold: 2
          httpGet:
            path: /healthz
            port: healthcheck
            scheme: HTTP
          initialDelaySeconds: 60
          periodSeconds: 10
        name: manager
        ports:
        - containerPort: 9443
          name: webhook-server
          protocol: TCP
        - containerPort: 8081
          name: healthcheck
          protocol: TCP
        readinessProbe:
          httpGet:
            path: /readyz
            port: healthcheck
            scheme: HTTP
          initialDelaySeconds: 5
          periodSeconds: 10
        resources:
          limits:
            cpu: 1000m
            memory: 1024Mi
          requests:
            cpu: 400m
            memory: 512Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: true
          runAsGroup: 998
          runAsNonRoot: true
          runAsUser: 999
        startupProbe:
          failureThreshold: 30
          httpGet:
            path: /healthz
            port: healthcheck
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp/k8s-webhook-server/serving-certs
          name: cert
          readOnly: true
        - mountPath: /tmp
          name: tmpfs
      hostNetwork: false
      serviceAccountName: apigee-manager
      terminationGracePeriodSeconds: 10
      volumes:
      - name: cert
        secret:
          defaultMode: 420
          secretName: webhook-server-cert
      - emptyDir: {}
        name: tmpfs
---
# Source: apigee-operator/templates/apigee-operators.yaml
apiVersion: admissionregistration.k8s.io/v1
kind: MutatingWebhookConfiguration
metadata:
  annotations:
    cert-manager.io/inject-ca-from: apigee/apigee-serving-cert
  name: apigee-mutating-webhook-configuration-apigee
webhooks:
- admissionReviewVersions:
  - v1
  - v1beta1
  clientConfig:
    service:
      name: apigee-webhook-service
      namespace: apigee
      path: /mutate-apigee-cloud-google-com-v1alpha1-apigeedatastore
  failurePolicy: Fail
  name: mapigeedatastore.apigee.cloud.google.com
  rules:
  - apiGroups:
    - apigee.cloud.google.com
    apiVersions:
    - v1alpha1
    operations:
    - CREATE
    - UPDATE
    resources:
    - apigeedatastores
  sideEffects: None
- admissionReviewVersions:
  - v1
  - v1beta1
  clientConfig:
    service:
      name: apigee-webhook-service
      namespace: apigee
      path: /mutate-apigee-cloud-google-com-v1alpha2-apigeeenvironment
  failurePolicy: Fail
  name: mapigeeenvironment.apigee.cloud.google.com
  rules:
  - apiGroups:
    - apigee.cloud.google.com
    apiVersions:
    - v1alpha2
    operations:
    - CREATE
    - UPDATE
    resources:
    - apigeeenvironments
  sideEffects: None
- admissionReviewVersions:
  - v1
  - v1beta1
  clientConfig:
    service:
      name: apigee-webhook-service
      namespace: apigee
      path: /mutate-apigee-cloud-google-com-v1alpha2-apigeeorganization
  failurePolicy: Fail
  name: mapigeeorganization.apigee.cloud.google.com
  rules:
  - apiGroups:
    - apigee.cloud.google.com
    apiVersions:
    - v1alpha2
    operations:
    - CREATE
    - UPDATE
    resources:
    - apigeeorganizations
  sideEffects: None
- admissionReviewVersions:
  - v1
  - v1beta1
  clientConfig:
    service:
      name: apigee-webhook-service
      namespace: apigee
      path: /mutate-apigee-cloud-google-com-v1alpha1-apigeeredis
  failurePolicy: Fail
  name: mapigeeredis.apigee.cloud.google.com
  rules:
  - apiGroups:
    - apigee.cloud.google.com
    apiVersions:
    - v1alpha1
    operations:
    - CREATE
    - UPDATE
    resources:
    - apigeeredis
  sideEffects: None
- admissionReviewVersions:
  - v1
  - v1beta1
  clientConfig:
    service:
      name: apigee-webhook-service
      namespace: apigee
      path: /mutate-apigee-cloud-google-com-v1alpha2-apigeeroute
  failurePolicy: Fail
  name: mapigeeroute.apigee.cloud.google.com
  rules:
  - apiGroups:
    - apigee.cloud.google.com
    apiVersions:
    - v1alpha2
    operations:
    - CREATE
    - UPDATE
    resources:
    - apigeeroutes
  sideEffects: None
- admissionReviewVersions:
  - v1
  - v1beta1
  clientConfig:
    service:
      name: apigee-webhook-service
      namespace: apigee
      path: /mutate-apigee-cloud-google-com-v1alpha2-apigeetelemetry
  failurePolicy: Fail
  name: mapigeetelemetry.apigee.cloud.google.com
  rules:
  - apiGroups:
    - apigee.cloud.google.com
    apiVersions:
    - v1alpha2
    operations:
    - CREATE
    - UPDATE
    resources:
    - apigeetelemetrys
  sideEffects: None
- admissionReviewVersions:
  - v1
  - v1beta1
  clientConfig:
    service:
      name: apigee-webhook-service
      namespace: apigee
      path: /mutate-apigee-cloud-google-com-v1alpha3-apigeedeployment
  failurePolicy: Fail
  name: mapigeedeployment.apigee.cloud.google.com
  rules:
  - apiGroups:
    - apigee.cloud.google.com
    apiVersions:
    - v1alpha3
    operations:
    - CREATE
    - UPDATE
    resources:
    - apigeedeployments
  sideEffects: None
---
# Source: apigee-operator/templates/apigee-operators.yaml
apiVersion: admissionregistration.k8s.io/v1
kind: ValidatingWebhookConfiguration
metadata:
  annotations:
    cert-manager.io/inject-ca-from: apigee/apigee-serving-cert
  name: apigee-validating-webhook-configuration-apigee
webhooks:
- admissionReviewVersions:
  - v1
  - v1beta1
  clientConfig:
    service:
      name: apigee-webhook-service
      namespace: apigee
      path: /validate-apigee-cloud-google-com-v1alpha1-apigeedatastore
  failurePolicy: Fail
  name: vapigeedatastore.apigee.cloud.google.com
  rules:
  - apiGroups:
    - apigee.cloud.google.com
    apiVersions:
    - v1alpha1
    operations:
    - CREATE
    - UPDATE
    - DELETE
    resources:
    - apigeedatastores
  sideEffects: None
- admissionReviewVersions:
  - v1
  - v1beta1
  clientConfig:
    service:
      name: apigee-webhook-service
      namespace: apigee
      path: /validate-apigee-cloud-google-com-v1alpha2-apigeeenvironment
  failurePolicy: Fail
  name: vapigeeenvironment.apigee.cloud.google.com
  rules:
  - apiGroups:
    - apigee.cloud.google.com
    apiVersions:
    - v1alpha2
    operations:
    - CREATE
    - UPDATE
    resources:
    - apigeeenvironments
  sideEffects: None
- admissionReviewVersions:
  - v1
  - v1beta1
  clientConfig:
    service:
      name: apigee-webhook-service
      namespace: apigee
      path: /validate-apigee-cloud-google-com-v1alpha2-apigeeorganization
  failurePolicy: Fail
  name: vapigeeorganization.apigee.cloud.google.com
  rules:
  - apiGroups:
    - apigee.cloud.google.com
    apiVersions:
    - v1alpha2
    operations:
    - CREATE
    - UPDATE
    resources:
    - apigeeorganizations
  sideEffects: None
- admissionReviewVersions:
  - v1
  - v1beta1
  clientConfig:
    service:
      name: apigee-webhook-service
      namespace: apigee
      path: /validate-apigee-cloud-google-com-v1alpha1-apigeeredis
  failurePolicy: Fail
  name: vapigeeredis.apigee.cloud.google.com
  rules:
  - apiGroups:
    - apigee.cloud.google.com
    apiVersions:
    - v1alpha1
    operations:
    - CREATE
    - UPDATE
    resources:
    - apigeeredis
  sideEffects: None
- admissionReviewVersions:
  - v1
  - v1beta1
  clientConfig:
    service:
      name: apigee-webhook-service
      namespace: apigee
      path: /validate-apigee-cloud-google-com-v1alpha2-apigeeroute
  failurePolicy: Fail
  name: vapigeeroute.apigee.cloud.google.com
  rules:
  - apiGroups:
    - apigee.cloud.google.com
    apiVersions:
    - v1alpha2
    operations:
    - CREATE
    - UPDATE
    resources:
    - apigeeroutes
  sideEffects: None
- admissionReviewVersions:
  - v1
  - v1beta1
  clientConfig:
    service:
      name: apigee-webhook-service
      namespace: apigee
      path: /validate-apigee-cloud-google-com-v1alpha2-apigeetelemetry
  failurePolicy: Fail
  name: vapigeetelemetry.apigee.cloud.google.com
  rules:
  - apiGroups:
    - apigee.cloud.google.com
    apiVersions:
    - v1alpha2
    operations:
    - CREATE
    - UPDATE
    resources:
    - apigeetelemetrys
  sideEffects: None
- admissionReviewVersions:
  - v1
  clientConfig:
    service:
      name: apigee-webhook-service
      namespace: apigee
      path: /validate-apigee-cloud-google-com-v1alpha1-secretrotation
  failurePolicy: Fail
  name: vsecretrotation.apigee.cloud.google.com
  rules:
  - apiGroups:
    - apigee.cloud.google.com
    apiVersions:
    - v1alpha1
    operations:
    - CREATE
    - UPDATE
    - DELETE
    resources:
    - secretrotations
  sideEffects: None
- admissionReviewVersions:
  - v1
  - v1beta1
  clientConfig:
    service:
      name: apigee-webhook-service
      namespace: apigee
      path: /validate-apigee-cloud-google-com-v1alpha3-apigeedeployment
  failurePolicy: Fail
  name: vapigeedeployment.apigee.cloud.google.com
  rules:
  - apiGroups:
    - apigee.cloud.google.com
    apiVersions:
    - v1alpha3
    operations:
    - CREATE
    - UPDATE
    resources:
    - apigeedeployments
  sideEffects: None
---
# Source: apigee-operator/templates/apigee-operators-roles.yaml
---
---
# Source: apigee-operator/templates/apigee-operators.yaml
# If we are running in an openshift cluster, we should install the appropriate SecurityContextConstraints
---
# Source: apigee-operator/templates/apigee-operators.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: apigee-serving-cert
  namespace: apigee
spec:
  dnsNames:
  - apigee-webhook-service.apigee.svc
  - apigee-webhook-service.apigee.svc.cluster.local
  issuerRef:
    kind: Issuer
    name: apigee-selfsigned-issuer
  secretName: webhook-server-cert
---
# Source: apigee-operator/templates/apigee-resources.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: apigee-ca
  namespace: cert-manager
  labels:
    apigee.cloud.google.com/platform: apigee
  annotations:
    helm.sh/resource-policy: keep
spec:
  isCA: true
  duration: 87600h # 10 years
  secretName: apigee-ca
  commonName: apigee-hybrid
  privateKey:
    algorithm: ECDSA
    size: 256
    rotationPolicy: Never
  subject:
    organizations:
    - cluster.local
    - apigee
  issuerRef:
    group: cert-manager.io
    kind: ClusterIssuer
    name: apigee-root-certificate-issuer # Uses apigee-root-certificate-issuer
---
# Source: apigee-operator/templates/apigee-resources.yaml
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: apigee-root-certificate-issuer
  labels:
    apigee.cloud.google.com/platform: apigee
  annotations:
    helm.sh/resource-policy: keep
spec:
  selfSigned: {}
---
# Source: apigee-operator/templates/apigee-resources.yaml
################################################################################
# `apigee-ca-issuer` is the issuer which will be used to issue certificates
# for Webhooks, CRDs and individual pods
################################################################################
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: apigee-ca-issuer
  labels:
    apigee.cloud.google.com/platform: apigee
  annotations:
    helm.sh/resource-policy: keep
spec:
  ca:
    secretName: apigee-ca
---
# Source: apigee-operator/templates/apigee-operators.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  name: apigee-selfsigned-issuer
  namespace: apigee
spec:
  selfSigned: {}

